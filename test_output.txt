
> aviation-platform@0.1.0 test
> jest src/components/auth src/lib/auth

FAIL src/lib/auth/__tests__/auth-context.test.tsx
  ΓùÅ F1: Auth Context (Session & Logout) ΓÇ║ F1.3.1: Session persists (initial load)

    invariant expected app router to be mounted

      22 |     const [session, setSession] = useState<Session | null>(null);
      23 |     const [loading, setLoading] = useState(true);
    > 24 |     const router = useRouter();
         |                             ^
      25 |     const supabase = createClientComponentClient();
      26 |
      27 |     useEffect(() => {

      at useRouter (node_modules/next/src/client/components/navigation.ts:149:11)
      at AuthProvider (src/lib/auth/auth-context.tsx:24:29)
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25904:20)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom-client.development.js:7662:22)
      at updateFunctionComponent (node_modules/react-dom/cjs/react-dom-client.development.js:10166:19)
      at beginWork (node_modules/react-dom/cjs/react-dom-client.development.js:11778:18)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom-client.development.js:17641:22)
      at workLoopSync (node_modules/react-dom/cjs/react-dom-client.development.js:17469:41)
      at renderRootSync (node_modules/react-dom/cjs/react-dom-client.development.js:17450:11)
      at performWorkOnRoot (node_modules/react-dom/cjs/react-dom-client.development.js:16583:35)
      at performWorkOnRootViaSchedulerTask (node_modules/react-dom/cjs/react-dom-client.development.js:18957:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:46:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:189:26)
      at render (node_modules/@testing-library/react/dist/pure.js:291:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:339:7)
      at Object.<anonymous> (src/lib/auth/__tests__/auth-context.test.tsx:32:38)

  ΓùÅ F1: Auth Context (Session & Logout) ΓÇ║ F1.4.1: Logout clears session

    invariant expected app router to be mounted

      22 |     const [session, setSession] = useState<Session | null>(null);
      23 |     const [loading, setLoading] = useState(true);
    > 24 |     const router = useRouter();
         |                             ^
      25 |     const supabase = createClientComponentClient();
      26 |
      27 |     useEffect(() => {

      at useRouter (node_modules/next/src/client/components/navigation.ts:149:11)
      at AuthProvider (src/lib/auth/auth-context.tsx:24:29)
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25904:20)
      at renderWithHooks (node_modules/react-dom/cjs/react-dom-client.development.js:7662:22)
      at updateFunctionComponent (node_modules/react-dom/cjs/react-dom-client.development.js:10166:19)
      at beginWork (node_modules/react-dom/cjs/react-dom-client.development.js:11778:18)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom-client.development.js:17641:22)
      at workLoopSync (node_modules/react-dom/cjs/react-dom-client.development.js:17469:41)
      at renderRootSync (node_modules/react-dom/cjs/react-dom-client.development.js:17450:11)
      at performWorkOnRoot (node_modules/react-dom/cjs/react-dom-client.development.js:16583:35)
      at performWorkOnRootViaSchedulerTask (node_modules/react-dom/cjs/react-dom-client.development.js:18957:7)
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:46:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:189:26)
      at render (node_modules/@testing-library/react/dist/pure.js:291:10)
      at renderHook (node_modules/@testing-library/react/dist/pure.js:339:7)
      at Object.<anonymous> (src/lib/auth/__tests__/auth-context.test.tsx:45:38)

FAIL src/components/auth/__tests__/register-form.test.tsx
  ΓùÅ F1: Registration Form ΓÇ║ F1.1.1: Valid email + password registers successfully

    TestingLibraryElementError: Found multiple elements with the text of: /password/i

    Here are the matching elements:

    Ignored nodes: comments, script, style
    <input
      autocomplete="new-password"
      class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
      id="password"
      name="password"
      type="password"
    />

    Ignored nodes: comments, script, style
    <input
      autocomplete="new-password"
      class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
      id="confirmPassword"
      name="confirmPassword"
      type="password"
    />

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    <body>
      <div>
        <div>
          <form
            class="space-y-6"
          >
            <div>
              <label
                class="block text-sm font-medium text-gray-700"
                for="email"
              >
                Email address
              </label>
              <div
                class="mt-1"
              >
                <input
                  autocomplete="email"
                  class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                  id="email"
                  name="email"
                  type="email"
                />
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700"
                for="password"
              >
                Password
              </label>
              <div
                class="mt-1"
              >
                <input
                  autocomplete="new-password"
                  class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                  id="password"
                  name="password"
                  type="password"
                />
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700"
                for="confirmPassword"
              >
                Confirm Password
              </label>
              <div
                class="mt-1"
              >
                <input
                  autocomplete="new-password"
                  class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                  id="confirmPassword"
                  name="confirmPassword"
                  type="password"
                />
              </div>
            </div>
            <div>
              <button
                class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                type="submit"
              >
                Create Account
              </button>
            </div>
          </form>
        </div>
      </div>
    </body>

      36 |
      37 |         await userEvent.type(screen.getByLabelText(/email/i), 'test@example.com');
    > 38 |         await userEvent.type(screen.getByLabelText(/password/i), 'Password123!');
         |                                     ^
      39 |         await userEvent.type(screen.getByLabelText(/confirm password/i), 'Password123!');
      40 |
      41 |         const submitBtn = screen.getByRole('button', { name: /create account/i });

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/components/auth/__tests__/register-form.test.tsx:38:37)

  ΓùÅ F1: Registration Form ΓÇ║ F1.1.3: Rejects invalid email format

    Unable to find an element with the text: /invalid email address/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <form
          class="space-y-6"
        >
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="email"
            >
              Email address
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="email"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="email"
                name="email"
                type="email"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="password"
            >
              Password
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="new-password"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="password"
                name="password"
                type="password"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="confirmPassword"
            >
              Confirm Password
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="new-password"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="confirmPassword"
                name="confirmPassword"
                type="password"
              />
            </div>
          </div>
          <div>
            <button
              class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              type="submit"
            >
              Create Account
            </button>
          </div>
        </form>
      </div>
    </body>

      54 |         await userEvent.click(screen.getByRole('button', { name: /create account/i }));
      55 |
    > 56 |         expect(await screen.findByText(/invalid email address/i)).toBeInTheDocument();
         |                             ^
      57 |         expect(mockSignUp).not.toHaveBeenCalled();
      58 |     });
      59 |

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:33
      at Object.findByText (src/components/auth/__tests__/register-form.test.tsx:56:29)

  ΓùÅ F1: Registration Form ΓÇ║ F1.1.4-6: Rejects weak passwords

    TestingLibraryElementError: Found multiple elements with the text of: /password/i

    Here are the matching elements:

    Ignored nodes: comments, script, style
    <input
      autocomplete="new-password"
      class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
      id="password"
      name="password"
      type="password"
    />

    Ignored nodes: comments, script, style
    <input
      autocomplete="new-password"
      class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
      id="confirmPassword"
      name="confirmPassword"
      type="password"
    />

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    <body>
      <div>
        <form
          class="space-y-6"
        >
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="email"
            >
              Email address
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="email"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="email"
                name="email"
                type="email"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="password"
            >
              Password
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="new-password"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="password"
                name="password"
                type="password"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="confirmPassword"
            >
              Confirm Password
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="new-password"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="confirmPassword"
                name="confirmPassword"
                type="password"
              />
            </div>
          </div>
          <div>
            <button
              class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              type="submit"
            >
              Create Account
            </button>
          </div>
        </form>
      </div>
    </body>

      63 |
      64 |         // Too short
    > 65 |         await userEvent.type(screen.getByLabelText(/password/i), 'short');
         |                                     ^
      66 |         await userEvent.click(screen.getByRole('button', { name: /create account/i }));
      67 |         expect(await screen.findByText(/at least 8 characters/i)).toBeInTheDocument();
      68 |

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at getElementError (node_modules/@testing-library/dom/dist/query-helpers.js:20:35)
      at getMultipleElementsFoundError (node_modules/@testing-library/dom/dist/query-helpers.js:23:10)
      at node_modules/@testing-library/dom/dist/query-helpers.js:55:13
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByLabelText (src/components/auth/__tests__/register-form.test.tsx:65:37)

FAIL src/components/auth/__tests__/login-form.test.tsx
  ΓùÅ F1: Login Form ΓÇ║ F1.2.1: Valid credentials login successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "test@example.com", "Password123!"
    Received: {"email": "test@example.com", "password": "Password123!"}

    Number of calls: 1

    Ignored nodes: comments, script, style
    <html>
      <head />
      <body>
        <div>
          <form
            class="space-y-6"
          >
            <div>
              <label
                class="block text-sm font-medium text-gray-700"
                for="email"
              >
                Email address
              </label>
              <div
                class="mt-1"
              >
                <input
                  autocomplete="email"
                  class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                  id="email"
                  name="email"
                  type="email"
                />
              </div>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700"
                for="password"
              >
                Password
              </label>
              <div
                class="mt-1"
              >
                <input
                  autocomplete="current-password"
                  class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                  id="password"
                  name="password"
                  type="password"
                />
              </div>
            </div>
            <div>
              <button
                class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
                type="submit"
              >
                Sign in
              </button>
            </div>
          </form>
        </div>
      </body>
    </html>

      34 |
      35 |         await waitFor(() => {
    > 36 |             expect(mockSignIn).toHaveBeenCalledWith('test@example.com', 'Password123!');
         |                                ^
      37 |         });
      38 |     });
      39 |

      at toHaveBeenCalledWith (src/components/auth/__tests__/login-form.test.tsx:36:32)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ΓùÅ F1: Login Form ΓÇ║ F1.2.3: Rejects invalid email

    Unable to find an element with the text: /invalid email address/i. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    <body>
      <div>
        <form
          class="space-y-6"
        >
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="email"
            >
              Email address
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="email"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="email"
                name="email"
                type="email"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-sm font-medium text-gray-700"
              for="password"
            >
              Password
            </label>
            <div
              class="mt-1"
            >
              <input
                autocomplete="current-password"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm px-3 py-2 border"
                id="password"
                name="password"
                type="password"
              />
            </div>
          </div>
          <div>
            <button
              class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"
              type="submit"
            >
              Sign in
            </button>
          </div>
        </form>
      </div>
    </body>

      45 |         await userEvent.click(screen.getByRole('button', { name: /sign in/i }));
      46 |
    > 47 |         expect(await screen.findByText(/invalid email address/i)).toBeInTheDocument();
         |                             ^
      48 |         expect(mockSignIn).not.toHaveBeenCalled();
      49 |     });
      50 |

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at node_modules/@testing-library/dom/dist/query-helpers.js:86:33
      at Object.findByText (src/components/auth/__tests__/login-form.test.tsx:47:29)

Test Suites: 3 failed, 3 total
Tests:       7 failed, 2 passed, 9 total
Snapshots:   0 total
Time:        4.833 s
Ran all test suites matching src/components/auth|src/lib/auth.
